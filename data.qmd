---
title: Data
description: We describe the sources of our data and the cleaning process.
toc: true
draft: false
---

![](images/Newyorkstate.png)

# Data Backgrounds

### Data Source

The major data we choose for our project is: Low- to Moderate-Income New York State Census Population Analysis Dataset. The data source is: https://www.nyserda.ny.gov/lmi-tool

This data comes from the U.S. Census Bureau's American Community Survey (ACS) 1-year Public Use Microdata Sample (PUMS) files for the years 2013, 2014, and 2015. It was collected by APPRISE as part of the NYSERDA Low- to Moderate-Income (LMI) Market Characterization Study. The primary objective of collecting this data was to analyze the low- to moderate-income population within New York State (NYS), aiming to understand their demographic, economic, and housing characteristics more comprehensively. The original source of the data is the U.S. Census Bureau, accessible through the ACS PUMS files. These files can typically be found on the Census Bureau's website or through specific data tools provided by research and policy organizations, including the mentioned NYSERDA LMI Analysis Tool.

### Data Collection

The sample population consists of households within New York State that responded to the ACS, specifically focusing on the low- to moderate-income groups. The study defines Low and Moderate families as follows:

-   Very Low Income: Income less than 130% U.S. Dept of Health and Human Services Poverty Guidelines

-   Low Income: Income greater than 130% U.S. Dept of Health and Human Services Poverty Guidelines but less than the greater of 150% U.S. Dept of Health and Human Services Poverty Guidelines vs. 60% State Median Income for New York

-   Moderate Income: Income greater than the greater of 150% U.S. Dept of Health and Human Services Poverty Guidelines vs. 60% State Median Income for New York but less than the greater of 80% State Median Income for New York vs. 80% Public Use Microdata Area Median Income

The survey aims to be representative of the entire population, but biases can occur. Also, there are some potential Issues with data collection. For example, self-reported data can sometimes be inaccurate due to misunderstandings of the questions, recall bias, or intentional misreporting.

### Data Purpose

This dataset is used to understand the characteristics and needs of the LMI population in NY State. It supports various analyses, such as evaluating the accessibility of housing, understanding the distribution of income groups, or assessing the prevalence of certain demographic characteristics within the LMI population. We believe the dataset can inform a range of policy decisions, particularly those related to economic development, housing, social services, and energy efficiency programs targeted at the LMI population. Researchers might use this data to explore questions related to socioeconomic disparities, housing affordability, energy insecurity, and the effectiveness of public assistance programs. By identifying the specific needs and challenges faced by these communities, policymakers and researchers can provide programs and interventions more effectively.

### Additional Dataset

The Additional Dataset we bring in for this project is Quarterly Census of Employment and Wages Annual Data of New York State. This dataset is about employment and wages data in New York state from the year of 2000. It contains employment and wages data for about 97% of all employment in New York, and data is organized by industry and county. For each record in this dataset, which is an employer, it has information about where it’s located (by country), ownership type(private or public), industry, year, average employment number within 12 months of that year, the total wage of all employees, and the annual average salary of its employees. We only take data from 2013-2015 from this dataset since the time period matches with our original dataset. With this dataset, we are able to compute wages data for each county or each industry, and do comparative analysis between counties.

An advantage of this dataset is that it can provide number value of average of average wages for each county. Our original dataset only has income value as a range and categorical variable, and this new dataset brings us more posibility with statistical analysis with income/wages as a number and continuous value.

## Variable Description

Here is a list of the variables we used from our major dataset and their meaning.

```{r, echo = FALSE}
library(knitr)
variables_df <- data.frame(
  Variable = c("County / County Group", "Income Groups", "Race / Ethnicity", "Owner-Renter Status", "Education Level", "Household Weight"),
  Data_Types = c("text", "text", "text", "text", "text", "number"),
  Description = c( 
    "Name of New York county or a group of New York counties.",
    "Ranges of annual household income in 2015 in USD",
    "Name of Race/Ethnicity: Asian, Black, Hispanic, Other, or White",
    "Owner-Renter status: Own, Rent/Other",
    "Highest education level achieved by household head: Less than High School Diploma, High School Diploma, Some College, Associate’s, Bachelor’s, or Graduate Degree",
    "The household weight is a number assigned to each record that indicates the number of households in the population that the observation represents.")
)
kable(variables_df, format = "html")
```

# Data Cleaning

[Link to the load_and_clean_data.R](scripts/load_and_clean_data.R)

We cleaned our major datasets with the following:

-   As per the instructions we checked the size of our data file and discovered that it was larger than 50mb. As a result we worked on the “load_and_clean_data.R” file, cleaning our “NYSERDA_LMI_Census_2013-2015.csv” file stored in the “dataset-ignore” folder.

```{r}
# Load necessary libraries
library(here)
library(readr)
library(tidyverse)
library(tidyr)

# Obtaining the data from the data-ignore folder since its > 50mb
dataset_path <- here("dataset-ignore", "NYSERDA_LMI_Census_2013-2015.csv")
data <- read_csv(dataset_path, show_col_types = FALSE)
```

-   Handling duplicate rows (eliminating them) for the sake of avoiding redundancy and potential biases. Furthermore we handled the one variable that had missing values: “Mortgage Indicator” by assigning missing values to “Unknown” to maintain data integrity and save the variable for future analysis that may reveal some patterns.
-   We then converted "character" types to "factor" types to facilitate future statistical analysis

```{r}
# Converting all character columns to factors
data <- data.frame(lapply(data, function(x) if(is.character(x)) factor(x) else x))
```

-   We reorganized the "County" column to exclude county groups but keep only county to enable cross-country comparative analysis and prepare for merge with the other dataset

```{r}
data <- data %>%
  mutate(`County...County.Group` = strsplit(as.character(`County...County.Group`), ",\\s*|&\\s*")) %>%
  unnest(`County...County.Group`) %>%
  mutate(`County...County.Group` = trimws(`County...County.Group`))  # Trim whitespace to avoid creating empty entries

# Ensuring there are no empty or NA county names after splitting
data <- data %>%
  filter(`County...County.Group` != "" & !is.na(`County...County.Group`))
```

-   Renamed variable name. We changed "County / County Group" to County, and used underscore to rename all the other variables like "Race / Ethnicity" to "Race_Ethnicity"
-   saved our new clean data file as a rds file: cleaned_NYSERDA_LMI_Census_2013-2015.rds to the dataset folder since it is now only 2.7mb.

### Combining Dataset

To bring the additional dataset for cross-county analysis, we didn't combined the new dataset to our original one directly, but created a secondary combined dataset at country level to directly use for county-level visualization and statistical analysis.

[Link to the file for combining dataset](combining-dataset/combining-dataset.qmd)

We did the following to combine the dataset and to make a new dataset:

-   read in the dataset and preliminary cleaning by Trim leading and trailing whitespace from all character columns

```{r}
library(dplyr)
library(stringr)
library(tidyr)

dataset_to_combine <- read.csv("combining-dataset/Quarterly_Census_of_Employment_and_Wages_Annual_Data__Beginning_2000_20240415.csv", stringsAsFactors = FALSE) |>
    mutate_if(is.character, str_trim)
```

-   Calculate the average wage for each county from the new dataset

```{r}
county_avg_wage <- 
  filter(dataset_to_combine, Area.Type == "County") |>
  group_by(Area) |>
  summarise(Total_Wages = sum(`Total.Wage`, na.rm = TRUE),
            Total_Employment = sum(`Average.Employment`, na.rm = TRUE)) |>
  mutate(Average_Wage = Total_Wages / Total_Employment) |>
  rename(County = Area) |>
  mutate(County = str_replace_all(County, fixed(" County"), "")) |>
  select(-c(Total_Wages, Total_Employment))
```

-   Merge it with our original data

```{r}
cleaned_dataset_path_rds <- here("dataset", "cleaned_NYSERDA_LMI_Census_2013-2015.rds")
original_data <- readRDS(cleaned_dataset_path_rds)
joined_dataset <- left_join(original_data, county_avg_wage, by = "County")
```

### Map Data

As we used map visualization to show the county difference in a NY state map, we also brought in map data that is stored in our data-ignore data. Here is a code of how we import the data

```{r include = FALSE}
clean_data <- readRDS("dataset-ignore/clean_data.rds")
```

```{r}
library(sf)
ny_counties <- st_read("dataset-ignore/tl_2023_us_county.shp")
demographic_data <- clean_data  
ny_counties <- ny_counties[ny_counties$STATEFP == '36', ]
```

### Additional Packages

For this project, we used a few other R packages outside of the ones we covered in class. We used library(RColorBrewer) anf library(leaflet) for creating the interactive maps, and library(nnet) for statistical modelling.
